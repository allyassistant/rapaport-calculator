<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#000000">
    <title>Mission Control</title>
    <style>
        :root {
            /* Liquid Glass Theme - iOS Style */
            --bg-primary: #000000;
            --bg-secondary: rgba(28, 28, 30, 0.6);
            --bg-card: rgba(255, 255, 255, 0.08);
            --bg-card-hover: rgba(255, 255, 255, 0.12);
            --bg-hover: rgba(255, 255, 255, 0.05);
            --text-primary: #FFFFFF;
            --text-secondary: rgba(255, 255, 255, 0.7);
            --text-tertiary: rgba(255, 255, 255, 0.5);
            --border: rgba(255, 255, 255, 0.15);
            --separator: rgba(255, 255, 255, 0.1);
            /* Glass effects */
            --glass-blur: blur(40px) saturate(180%);
            --glass-blur-heavy: blur(60px) saturate(200%);
            --glass-border: rgba(255, 255, 255, 0.2);
            --glass-shine: rgba(255, 255, 255, 0.3);
            /* Accent colors - vibrant for glass */
            --blue: #0A84FF;
            --blue-glow: rgba(10, 132, 255, 0.4);
            --green: #30D158;
            --green-glow: rgba(48, 209, 88, 0.4);
            --brown: #A2845E;
            --purple: #BF5AF2;
            --purple-glow: rgba(191, 90, 242, 0.4);
            --orange: #FF9F0A;
            --orange-glow: rgba(255, 159, 10, 0.4);
            --red: #FF453A;
            --yellow: #FFD60A;
            --safe-top: env(safe-area-inset-top);
            --safe-bottom: env(safe-area-inset-bottom);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'SF Pro Text', sans-serif;
            background: 
                radial-gradient(ellipse at 20% 20%, rgba(10, 132, 255, 0.15) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 80%, rgba(191, 90, 242, 0.1) 0%, transparent 50%),
                radial-gradient(ellipse at 50% 50%, rgba(48, 209, 88, 0.08) 0%, transparent 60%),
                #000000;
            background-attachment: fixed;
            color: var(--text-primary);
            min-height: 100vh;
            overflow: hidden;
        }
        
        .app {
            height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        /* Header - Liquid Glass */
        .header {
            padding: 12px 16px;
            padding-top: calc(12px + var(--safe-top));
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: var(--glass-blur);
            border-bottom: 1px solid var(--glass-border);
            position: relative;
        }
        
        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, var(--glass-shine), transparent);
        }
        
        .header-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .header-left {
            display: flex;
            flex-direction: column;
        }
        
        .header-title {
            font-size: 28px;
            font-weight: 700;
            letter-spacing: -0.5px;
        }
        
        .header-subtitle {
            font-size: 13px;
            color: var(--text-tertiary);
        }
        
        .status-badge {
            display: flex;
            align-items: center;
            gap: 6px;
            background: rgba(48, 209, 88, 0.15);
            color: var(--green);
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
        }
        
        .status-dot {
            width: 6px;
            height: 6px;
            background: var(--green);
            border-radius: 50%;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Content */
        .content {
            flex: 1;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            padding: 16px;
            padding-bottom: calc(80px + var(--safe-bottom));
        }
        
        .content::-webkit-scrollbar {
            display: none;
        }
        
        /* Section Title */
        .section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
        }
        
        .section-title {
            font-size: 20px;
            font-weight: 700;
        }
        
        .section-subtitle {
            font-size: 14px;
            color: var(--text-tertiary);
            font-weight: 400;
            margin-left: 8px;
        }
        
        .filter-btn {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: var(--text-secondary);
            padding: 6px 12px;
            border-radius: 8px;
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        /* Bot Grid (Dashboard) */
        .bot-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 16px;
        }
        
        .bot-card {
            background: var(--bg-card);
            backdrop-filter: var(--glass-blur);
            border-radius: 20px;
            padding: 16px;
            position: relative;
            overflow: hidden;
            border: 1px solid var(--glass-border);
            box-shadow: 
                0 8px 32px rgba(0, 0, 0, 0.3),
                inset 0 1px 0 var(--glass-shine);
            transition: all 0.3s ease;
        }
        
        .bot-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 50%;
            background: linear-gradient(180deg, rgba(255,255,255,0.1) 0%, transparent 100%);
            border-radius: 20px 20px 0 0;
            pointer-events: none;
        }
        
        .bot-card.blue {
            background: var(--bg-card);
            border-color: var(--glass-border);
            box-shadow: 
                0 8px 32px rgba(0, 0, 0, 0.3),
                inset 0 1px 0 var(--glass-shine);
        }
        
        .bot-card.green {
            background: var(--bg-card);
            border-color: var(--glass-border);
            box-shadow: 
                0 8px 32px rgba(0, 0, 0, 0.3),
                inset 0 1px 0 var(--glass-shine);
        }
        
        .bot-card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 8px;
        }
        
        .bot-name {
            font-size: 17px;
            font-weight: 600;
        }
        
        .bot-count {
            font-size: 13px;
            color: var(--text-secondary);
        }
        
        /* Stat Cards - Liquid Glass */
        .stat-card {
            background: var(--bg-card);
            backdrop-filter: var(--glass-blur);
            border-radius: 20px;
            padding: 16px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
            border: 1px solid var(--glass-border);
            box-shadow: 
                0 8px 32px rgba(0, 0, 0, 0.3),
                inset 0 1px 0 var(--glass-shine);
            transition: all 0.3s ease;
        }
        
        .stat-card:active {
            transform: scale(0.98);
        }
        
        .stat-info {
            display: flex;
            flex-direction: column;
        }
        
        .stat-label {
            font-size: 13px;
            color: var(--text-tertiary);
            margin-bottom: 4px;
        }
        
        .stat-value {
            font-size: 32px;
            font-weight: 700;
        }
        
        .stat-icon {
            width: 48px;
            height: 48px;
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .stat-icon.blue { 
            background: rgba(10, 132, 255, 0.2); 
            box-shadow: 0 4px 15px rgba(10, 132, 255, 0.3);
        }
        .stat-icon.purple { 
            background: rgba(191, 90, 242, 0.2); 
            box-shadow: 0 4px 15px rgba(191, 90, 242, 0.3);
        }
        .stat-icon.green { 
            background: rgba(48, 209, 88, 0.2); 
            box-shadow: 0 4px 15px rgba(48, 209, 88, 0.3);
        }
        .stat-icon.orange { 
            background: rgba(255, 159, 10, 0.2); 
            box-shadow: 0 4px 15px rgba(255, 159, 10, 0.3);
        }
        
        /* Activity Feed - Liquid Glass */
        .activity-list {
            display: flex;
            flex-direction: column;
        }
        
        .activity-list.legacy {
            background: var(--bg-card);
            backdrop-filter: var(--glass-blur);
            border-radius: 20px;
            border: 1px solid var(--glass-border);
            box-shadow: 
                0 8px 32px rgba(0, 0, 0, 0.3),
                inset 0 1px 0 var(--glass-shine);
            overflow: hidden;
        }
        
        .activity-item {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            border-bottom: 0.5px solid var(--separator);
        }
        
        .activity-item:last-child {
            border-bottom: none;
        }
        
        .activity-time {
            width: 50px;
            font-size: 12px;
            color: var(--text-secondary);
            flex-shrink: 0;
        }
        
        .activity-icon {
            width: 28px;
            height: 28px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            margin-right: 10px;
            flex-shrink: 0;
        }
        
        .activity-badge {
            font-size: 11px;
            padding: 3px 8px;
            border-radius: 4px;
            font-weight: 500;
            margin-right: 10px;
            flex-shrink: 0;
        }
        
        .activity-badge.tachikoma { background: rgba(10, 132, 255, 0.2); color: var(--blue); }
        .activity-badge.crabby { background: rgba(255, 159, 10, 0.2); color: var(--orange); }
        .activity-badge.crowley { background: rgba(191, 90, 242, 0.2); color: var(--purple); }
        
        .activity-text {
            flex: 1;
            font-size: 14px;
        }
        
        .activity-status {
            width: 20px;
            text-align: center;
            flex-shrink: 0;
        }
        
        .status-success { color: var(--green); }
        .status-error { color: var(--red); }
        .status-pending { color: var(--orange); }
        
        /* Filter Tags */
        .filter-tags {
            display: flex;
            gap: 8px;
            margin-bottom: 12px;
            overflow-x: auto;
            padding-bottom: 4px;
        }
        
        .filter-tags::-webkit-scrollbar {
            display: none;
        }
        
        .filter-tag {
            padding: 6px 12px;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 500;
            white-space: nowrap;
            cursor: pointer;
            border: none;
            background: var(--bg-card);
            color: var(--text-secondary);
        }
        
        .filter-tag.active {
            background: rgba(48, 209, 88, 0.2);
            color: var(--green);
        }
        
        .filter-tag.error {
            background: rgba(255, 69, 58, 0.2);
            color: var(--red);
        }
        
        .filter-tag.pending {
            background: rgba(255, 214, 10, 0.2);
            color: var(--yellow);
        }
        
        /* Kanban Grid - 2x2 Layout */
        .kanban-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            grid-template-rows: 1fr 1fr;
            gap: 16px;
            height: calc(100vh - 200px);
            min-height: 500px;
            overflow-x: hidden;
            overflow-y: auto;
        }
        
        .kanban-grid .kanban-column {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(40px) saturate(180%);
            border-radius: 20px;
            padding: 16px;
            border: 1px solid rgba(255, 255, 255, 0.15);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.1);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            min-width: 0;
        }
        
        .kanban-grid .kanban-cards {
            flex: 1;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            overflow-x: hidden;
            padding-right: 4px;
        }
        
        /* Kanban Column Colors */
        .kanban-todo {
            border-top: 4px solid var(--yellow) !important;
        }
        
        .kanban-todo .kanban-column-title {
            color: var(--yellow);
        }
        
        .kanban-progress {
            border-top: 4px solid var(--blue) !important;
        }
        
        .kanban-progress .kanban-column-title {
            color: var(--blue);
        }
        
        .kanban-review {
            border-top: 4px solid var(--purple) !important;
        }
        
        .kanban-review .kanban-column-title {
            color: var(--purple);
        }
        
        .kanban-done {
            border-top: 4px solid var(--green) !important;
        }
        
        .kanban-done .kanban-column-title {
            color: var(--green);
        }
        
        /* Kanban */
        .kanban-container {
            display: flex;
            gap: 12px;
            overflow-x: auto;
            padding-bottom: 8px;
            -webkit-overflow-scrolling: touch;
        }
        
        .kanban-container::-webkit-scrollbar {
            height: 4px;
        }
        
        .kanban-column {
            min-width: 280px;
            flex-shrink: 0;
        }
        
        .kanban-column-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
            padding: 0 4px;
        }
        
        .kanban-column-title {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 17px;
            font-weight: 600;
            color: var(--text-secondary);
        }
        
        .kanban-column-count {
            background: rgba(255, 255, 255, 0.1);
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 12px;
        }
        
        .kanban-cards {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .kanban-card {
            background: var(--bg-card);
            backdrop-filter: var(--glass-blur);
            border-radius: 16px;
            padding: 14px;
            border: 1px solid var(--glass-border);
            box-shadow: 
                0 4px 20px rgba(0, 0, 0, 0.2),
                inset 0 1px 0 var(--glass-shine);
            transition: all 0.3s ease;
        }
        
        .kanban-card:active {
            transform: scale(0.98);
        }
        
        .kanban-card-title {
            font-size: 15px;
            font-weight: 500;
            margin-bottom: 8px;
            line-height: 1.4;
        }
        
        .kanban-card-desc {
            font-size: 12px;
            color: var(--text-tertiary);
            margin-bottom: 12px;
            line-height: 1.5;
        }
        
        .kanban-card-footer {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .kanban-card-bot {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 12px;
            padding: 4px 10px;
            border-radius: 6px;
        }
        
        .kanban-card-bot.crowley { background: rgba(191, 90, 242, 0.35); color: var(--purple); }
        .kanban-card-bot.tachikoma { background: rgba(10, 132, 255, 0.35); color: var(--blue); }
        
        .kanban-card-bot.kimi {
            background: rgba(10, 132, 255, 0.35);
            color: var(--blue);
        }
        
        .kanban-card-bot.qwen3 {
            background: rgba(48, 209, 88, 0.35);
            color: var(--green);
        }
        
        .kanban-card-time {
            font-size: 12px;
            color: var(--text-tertiary);
        }
        
        /* Calendar */
        .calendar-date {
            font-size: 14px;
            color: var(--text-tertiary);
            margin-bottom: 12px;
        }
        
        .calendar-events {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .calendar-event-card {
            background: var(--bg-card);
            backdrop-filter: var(--glass-blur);
            border-radius: 16px;
            padding: 14px;
            border: 1px solid var(--glass-border);
            border-left: 3px solid var(--purple);
            box-shadow: 
                0 4px 20px rgba(0, 0, 0, 0.2),
                inset 0 1px 0 var(--glass-shine);
            transition: all 0.3s ease;
        }
        
        .calendar-event-card.cron {
            border-left-color: var(--blue);
        }
        
        .calendar-event-card.task {
            border-left-color: var(--green);
        }
        
        .calendar-event-time {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 13px;
            color: var(--purple);
            margin-bottom: 6px;
        }
        
        .calendar-event-card.cron .calendar-event-time {
            color: var(--blue);
        }
        
        .calendar-event-title {
            font-size: 15px;
            font-weight: 500;
            margin-bottom: 4px;
        }
        
        .calendar-event-subtitle {
            font-size: 12px;
            color: var(--text-tertiary);
        }
        
        .calendar-event-bot {
            float: right;
            font-size: 11px;
            padding: 3px 8px;
            border-radius: 4px;
            background: rgba(191, 90, 242, 0.2);
            color: var(--purple);
        }
        
        .calendar-event-bot.kimi {
            background: rgba(10, 132, 255, 0.2);
            color: var(--blue);
        }
        
        .calendar-event-bot.qwen3 {
            background: rgba(48, 209, 88, 0.2);
            color: var(--green);
        }
        
        /* Calendar Event Card Status Colors */
        .calendar-event-card.todo {
            border-left: 5px solid var(--yellow);
        }
        
        .calendar-event-card.todo .calendar-event-time {
            color: var(--yellow);
        }
        
        .calendar-event-card.inprogress {
            border-left: 5px solid var(--blue);
        }
        
        .calendar-event-card.inprogress .calendar-event-time {
            color: var(--blue);
        }
        
        .calendar-event-card.review {
            border-left: 5px solid var(--purple);
        }
        
        .calendar-event-card.review .calendar-event-time {
            color: var(--purple);
        }
        
        .calendar-event-card.done {
            border-left: 5px solid var(--green);
        }
        
        .calendar-event-card.done .calendar-event-time {
            color: var(--green);
        }
        
        /* Bottom Nav - Liquid Glass iOS Style */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding: 12px 8px calc(20px + var(--safe-bottom));
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: var(--glass-blur-heavy);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 
                0 -8px 32px rgba(0, 0, 0, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.15);
            z-index: 1000;
        }
        
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 4px;
            padding: 8px 20px;
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 24px;
            color: rgba(255, 255, 255, 0.6);
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            cursor: pointer;
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
            min-width: 70px;
            min-height: 44px;
            backdrop-filter: blur(10px);
        }
        
        .nav-item:active {
            transform: scale(0.92);
        }
        
        .nav-item.active {
            color: var(--text-primary);
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.3);
            box-shadow: 
                0 4px 15px rgba(0, 0, 0, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }
        
        .nav-icon {
            font-size: 24px;
            line-height: 1;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.4));
        }
        
        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-tertiary);
        }
        
        /* Tab Switcher */
        .tab-switcher {
            display: flex;
            background: var(--bg-card);
            border-radius: 10px;
            padding: 4px;
            margin-bottom: 16px;
            border: 0.5px solid var(--separator);
        }
        
        .tab-btn {
            flex: 1;
            padding: 8px;
            border: none;
            background: transparent;
            color: var(--text-secondary);
            font-size: 13px;
            font-weight: 500;
            border-radius: 8px;
            cursor: pointer;
        }
        
        .tab-btn.active {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-primary);
        }
    </style>
</head>
<body>
    <div class="app">
        <header class="header">
            <div class="header-content">
                <div class="header-left">
                    <h1 class="header-title">Mission Control</h1>
                    <span class="header-subtitle">AI Assistant Dashboard</span>
                </div>
                <div style="display: flex; align-items: center; gap: 10px;">
                    <button class="status-badge" id="system-status-badge" onclick="openHealthModal()" style="cursor: pointer; border: none; background: rgba(48, 209, 88, 0.15);">
                        <span class="status-dot"></span>
                        <span id="system-status-text">System Online</span>
                    </button>
                </div>
            </div>
        </header>
        
        <main class="content" id="main-content">
            <!-- Dynamic content -->
        </main>
        
        <nav class="bottom-nav">
            <button class="nav-item active" onclick="switchTab('dashboard', event)">
                <span>Dashboard</span>
            </button>
            <button class="nav-item" onclick="switchTab('tasks', event)">
                <span>Kanban</span>
            </button>
            <button class="nav-item" onclick="switchTab('search', event)">
                <span>Search</span>
            </button>
        </nav>
    </div>
    
    <!-- System Health Modal -->
    <div id="health-modal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.7); backdrop-filter: blur(20px); z-index: 1000;">
        <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 90%; max-width: 400px; background: rgba(255, 255, 255, 0.08); backdrop-filter: blur(40px) saturate(180%); border-radius: 24px; padding: 20px; border: 1px solid rgba(255, 255, 255, 0.2); box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5), inset 0 1px 0 rgba(255, 255, 255, 0.3);">
            <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px;">
                <span style="font-size: 20px; font-weight: 700;">System Health</span>
                <button onclick="closeHealthModal()" style="background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.15); border-radius: 50%; width: 36px; height: 36px; color: var(--text-secondary); font-size: 24px; cursor: pointer; display: flex; align-items: center; justify-content: center; backdrop-filter: blur(10px); line-height: 1; padding-bottom: 4px;">√ó</button>
            </div>
            
            <div style="margin-bottom: 16px;">
                <div style="font-size: 12px; color: var(--text-tertiary); margin-bottom: 4px; text-transform: uppercase; letter-spacing: 0.5px;">Last Check</div>
                <div id="modal-last-check" style="font-size: 14px; font-weight: 500;">--</div>
            </div>
            
            <div id="health-services" style="display: flex; flex-direction: column; gap: 12px;">
                <!-- Services will be injected here -->
            </div>
            
            <div style="margin-top: 20px; padding-top: 16px; border-top: 1px solid rgba(255, 255, 255, 0.1);">
                <div style="display: flex; align-items: center; justify-content: space-between;">
                    <span style="font-size: 13px; color: var(--text-secondary);">Overall Status</span>
                    <span id="modal-overall-status" style="font-size: 14px; font-weight: 600; color: var(--green); padding: 4px 12px; border-radius: 12px; background: rgba(48, 209, 88, 0.15);">Online</span>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Model Activities Modal -->
    <div id="model-activities-modal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.7); backdrop-filter: blur(20px); z-index: 1000;">
        <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 90%; max-width: 400px; height: 520px; background: var(--bg-card); backdrop-filter: var(--glass-blur); border-radius: 24px; padding: 24px; border: 1px solid var(--glass-border); box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3), inset 0 1px 0 var(--glass-shine); display: flex; flex-direction: column;">
            <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px; flex-shrink: 0;">
                <span id="model-activities-title" style="font-size: 20px; font-weight: 700;">Model Activities</span>
                <button onclick="closeModelActivitiesModal()" style="background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.15); border-radius: 50%; width: 36px; height: 36px; color: var(--text-secondary); font-size: 24px; cursor: pointer; display: flex; align-items: center; justify-content: center; backdrop-filter: blur(10px); line-height: 1; padding-bottom: 4px;">√ó</button>
            </div>
            <div id="model-activities-list" style="flex: 1; overflow-y: auto; -webkit-overflow-scrolling: touch; margin: 0 -4px; padding: 0 4px;">
                <!-- Activities will be injected here -->
            </div>
        </div>
    </div>
    
    <!-- Kanban Column Modal -->
    <div id="kanban-column-modal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.7); backdrop-filter: blur(20px); z-index: 1000;">
        <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 90%; max-width: 400px; max-height: 80vh; background: var(--bg-card); backdrop-filter: var(--glass-blur); border-radius: 24px; padding: 20px; border: 1px solid var(--glass-border); box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3), inset 0 1px 0 var(--glass-shine); display: flex; flex-direction: column;">
            <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 16px; flex-shrink: 0;">
                <span id="kanban-column-title" style="font-size: 20px; font-weight: 700;">Column Tasks</span>
                <button onclick="closeKanbanColumnModal()" style="background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.15); border-radius: 50%; width: 36px; height: 36px; color: var(--text-secondary); font-size: 24px; cursor: pointer; display: flex; align-items: center; justify-content: center; backdrop-filter: blur(10px); line-height: 1; padding-bottom: 4px;">√ó</button>
            </div>
            <div id="kanban-column-list" style="flex: 1; overflow-y: auto; -webkit-overflow-scrolling: touch;">
                <!-- Tasks will be injected here -->
            </div>
        </div>
    </div>
    
    <script>
        // Kanban column data
        const kanbanColumnData = {
            'todo': {
                title: 'Todo',
                color: 'var(--yellow)',
                items: [
                    { title: 'Apple Notes ÂÇô‰ªΩÈ©óË≠âÊ©üÂà∂', desc: 'ÂâµÂª∫ËÖ≥Êú¨È©óË≠â Apple Notes ÂÇô‰ªΩÂÆåÊï¥ÊÄß', bot: 'System', time: 'È´òÂÑ™ÂÖàÁ¥ö', botClass: '' },
                    { title: 'Qwen3 Excel Dynamic Arrays Ë®ìÁ∑¥', desc: '', bot: 'Qwen3', time: '‰ªäÊôö 03:00', botClass: 'qwen3' }
                ]
            },
            'progress': {
                title: 'In Progress',
                color: 'var(--blue)',
                items: [
                    { title: 'MEMORY.md ÈóúÈçµË®òÊÜ∂Ê®ôË®ò', desc: 'Âª∫Á´ãÊ©üÂà∂Èò≤Ê≠¢ÈáçË¶ÅË≥áË®äË¢´Ë™§Âà™', bot: 'System', time: 'ÈÄ≤Ë°å‰∏≠', botClass: '' }
                ]
            },
            'review': {
                title: 'Review',
                color: 'var(--purple)',
                items: []
            },
            'done': {
                title: 'Done',
                color: 'var(--green)',
                items: [
                    { title: 'Excel XLOOKUP Ë®ìÁ∑¥ÂÆåÊàê', desc: '', bot: 'Qwen3', time: 'Feb 6', botClass: 'qwen3' },
                    { title: 'Excel INDEX+MATCH Ë®ìÁ∑¥ÂÆåÊàê', desc: '', bot: 'Qwen3', time: 'Feb 7', botClass: 'qwen3' }
                ]
            }
        };
        
        function openKanbanColumnModal(columnId) {
            const modal = document.getElementById('kanban-column-modal');
            const modalContent = modal.querySelector('div');
            const title = document.getElementById('kanban-column-title');
            const list = document.getElementById('kanban-column-list');
            
            const column = kanbanColumnData[columnId];
            const color = column.color;
            
            title.textContent = column.title + ' (' + column.items.length + ')';
            title.style.color = color;
            
            modalContent.style.borderTop = '4px solid ' + color;
            
            if (column.items.length === 0) {
                list.innerHTML = '<div style="text-align: center; padding: 60px 20px; color: var(--text-tertiary);">No items</div>';
            } else {
                list.innerHTML = column.items.map(item => `
                    <div style="background: rgba(255, 255, 255, 0.06); backdrop-filter: blur(20px); border-radius: 16px; padding: 14px; margin-bottom: 10px; border: 1px solid rgba(255, 255, 255, 0.15); box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2), inset 0 1px 0 rgba(255, 255, 255, 0.1);">
                        <div style="font-size: 15px; font-weight: 500; margin-bottom: ${item.desc ? '6px' : '0'}; line-height: 1.4;">${item.title}</div>
                        ${item.desc ? `<div style="font-size: 12px; color: var(--text-tertiary); margin-bottom: 10px; line-height: 1.5;">${item.desc}</div>` : ''}
                        <div style="display: flex; align-items: center; justify-content: space-between;">
                            <span class="kanban-card-bot ${item.botClass}" style="font-size: 11px; padding: 3px 8px; border-radius: 4px; ${item.botClass === '' ? 'background: rgba(162, 132, 94, 0.35); color: var(--brown);' : ''}">${item.bot}</span>
                            <span style="font-size: 12px; color: var(--text-tertiary);">${item.time}</span>
                        </div>
                    </div>
                `).join('');
            }
            
            modal.style.display = 'block';
        }
        
        function closeKanbanColumnModal() {
            document.getElementById('kanban-column-modal').style.display = 'none';
        }
        
        // Close modal when clicking outside
        document.getElementById('kanban-column-modal').addEventListener('click', function(e) {
            if (e.target === this) closeKanbanColumnModal();
        });
        
        // Data
        const bots = {
            'ally-main': { name: 'Ally', color: 'blue', icon: '', today: 12, online: true },
            'qwen3': { name: 'Qwen3', color: 'green', icon: '', today: 8, online: true },
            'kimi': { name: 'Kimi', color: 'purple', icon: '', today: 15, online: true }
        };
        
        // Ê®°ÂûãÊï∏ÊìöÔºàÂè™ÂàÜ Qwen3 Âêå KimiÔºâ- Kimi ÂÖàÈ°ØÁ§∫
        const modelStats = {
            'kimi': { 
                name: 'Kimi K2.5', 
                color: 'blue', 
                icon: '‚òÅÔ∏è', 
                online: true,
                activities: 23, 
                scheduled: 3, 
                completed: 2,
                serviceKey: 'kimi'
            },
            'qwen3': { 
                name: 'Qwen3 14B', 
                color: 'green', 
                icon: 'ü¶æ', 
                online: true,
                activities: 20, 
                scheduled: 5, 
                completed: 3,
                serviceKey: 'qwen3'
            }
        };
        
        // Model activities data
        const modelActivitiesData = {
            'kimi': {
                activities: [
                    { time: '01:15', icon: 'üîç', text: 'Web search: Mission Control best practices', status: 'success' },
                    { time: '00:45', icon: 'üìù', text: 'Generated daily summary report', status: 'success' },
                    { time: 'Yesterday', icon: 'üîç', text: 'Web search: Rapaport price trends', status: 'success' },
                    { time: 'Yesterday', icon: 'üí¨', text: 'Analyzed diamond market data', status: 'success' },
                    { time: 'Feb 9', icon: 'üîç', text: 'Research: PWA development', status: 'success' }
                ],
                scheduled: [
                    { time: 'Tomorrow 10:00', icon: 'üëÄ', text: 'Review Tasks - ÂØ©Èñ±ÂæÖËæ¶‰∫ãÈ†Ö', status: 'pending' },
                    { time: 'Feb 12 14:00', icon: 'üîç', text: 'Weekly market research', status: 'pending' },
                    { time: 'Feb 15 09:00', icon: 'üìù', text: 'Monthly summary generation', status: 'pending' }
                ],
                completed: [
                    { time: 'Feb 9', icon: '‚úì', text: 'Heartbeat maintenance check', status: 'success' },
                    { time: 'Feb 8', icon: '‚úì', text: 'Apple Notes backup verification', status: 'success' }
                ]
            },
            'qwen3': {
                activities: [
                    { time: '00:50', icon: '‚ö°', text: 'Completed INDEX+MATCH training module', status: 'success' },
                    { time: 'Feb 7', icon: '‚ö°', text: 'Completed Excel training: INDEX+MATCH', status: 'success' },
                    { time: 'Feb 6', icon: '‚ö°', text: 'Completed Excel training: XLOOKUP', status: 'success' },
                    { time: 'Feb 5', icon: 'üìä', text: 'Diamond price calculation practice', status: 'success' },
                    { time: 'Feb 4', icon: 'üìä', text: 'Stock list data processing', status: 'success' }
                ],
                scheduled: [
                    { time: 'Today 03:00', icon: 'üìö', text: 'Excel Training - Dynamic Arrays', status: 'pending' },
                    { time: 'Today 09:00', icon: 'üìä', text: 'Progress Report - Â≠∏ÁøíÈÄ≤Â∫¶ÂåØÂ†±', status: 'pending' },
                    { time: 'Tomorrow 03:00', icon: 'üìö', text: 'Advanced Excel formulas practice', status: 'pending' },
                    { time: 'Feb 13 03:00', icon: 'üìö', text: 'Diamond knowledge quiz', status: 'pending' },
                    { time: 'Feb 14 03:00', icon: 'üìö', text: 'Rapaport price system training', status: 'pending' }
                ],
                completed: [
                    { time: 'Feb 7', icon: '‚úì', text: 'INDEX+MATCH training completed', status: 'success' },
                    { time: 'Feb 6', icon: '‚úì', text: 'XLOOKUP training completed', status: 'success' },
                    { time: 'Feb 4-5', icon: '‚úì', text: 'Excel basics refresher', status: 'success' }
                ]
            }
        };
        
        let currentTab = 'dashboard';
        let lastRealStatus = null;
        let usingRealData = false;
        
        function switchTab(tab, event) {
            currentTab = tab;
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            if (event && event.target) {
                event.target.closest('.nav-item').classList.add('active');
            } else {
                // Fallback: find by text content or index
                const navItems = document.querySelectorAll('.nav-item');
                const tabIndex = ['dashboard', 'tasks', 'search'].indexOf(tab);
                if (tabIndex >= 0 && navItems[tabIndex]) {
                    navItems[tabIndex].classList.add('active');
                }
            }
            savePreferences(); // ÂÑ≤Â≠òÁï∂Ââç tab
            render();
        }
        
        function render() {
            const content = document.getElementById('main-content');
            
            switch(currentTab) {
                case 'dashboard':
                    content.innerHTML = renderDashboard();
                    break;
                case 'tasks':
                    content.innerHTML = renderTasks();
                    break;
                case 'search':
                    content.innerHTML = renderSearch();
                    break;
            }
        }
        
        function renderDashboard() {
            // Êõ¥Êñ∞Ê®°ÂûãÂú®Á∑öÁãÄÊÖã
            Object.entries(modelStats).forEach(([id, model]) => {
                if (model.serviceKey && lastRealStatus) {
                    const realStatus = lastRealStatus[model.serviceKey];
                    if (realStatus) {
                        model.online = realStatus.status === 'online';
                    }
                }
            });
            
            const botCards = Object.entries(bots).map(([id, bot]) => `
                <div class="bot-card ${bot.color}">
                    <div class="bot-card-header">
                        <span class="bot-name">${bot.name}</span>
                        <span class="bot-icon">${bot.online ? 'üì∂' : 'üîá'}</span>
                    </div>
                    <div class="bot-count">${bot.today} today</div>
                </div>
            `).join('');
            
            const modelCards = Object.entries(modelStats).map(([id, model]) => `
                <div class="bot-card ${model.color}" onclick="openModelActivitiesModal('${id}')" style="cursor: pointer; position: relative;">
                    <div style="position: absolute; top: 12px; right: 12px; width: 10px; height: 10px; background: ${model.online ? 'var(--green)' : 'var(--red)'}; border-radius: 50%; box-shadow: 0 0 8px ${model.online ? 'var(--green)' : 'var(--red)'}; ${model.online ? 'animation: pulse 2s infinite;' : ''}"></div>
                    <div class="bot-card-header">
                        <span class="bot-name">${model.name}</span>
                    </div>
                    <div style="margin-top: 16px; display: flex; flex-direction: column; gap: 10px;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span style="font-size: 11px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.3px; padding: 4px 10px; border-radius: 20px; background: rgba(255, 255, 255, 0.1); color: var(--text-secondary);">Activities</span>
                            <span style="font-size: 18px; font-weight: 700; color: var(--text-primary);">${model.activities}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span style="font-size: 11px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.3px; padding: 4px 10px; border-radius: 20px; background: rgba(255, 255, 255, 0.1); color: var(--text-secondary);">Scheduled</span>
                            <span style="font-size: 16px; font-weight: 600; color: var(--text-primary);">${model.scheduled}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span style="font-size: 11px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.3px; padding: 4px 10px; border-radius: 20px; background: rgba(255, 255, 255, 0.1); color: var(--text-secondary);">Completed</span>
                            <span style="font-size: 16px; font-weight: 600; color: var(--text-primary);">${model.completed}</span>
                        </div>
                    </div>
                </div>
            `).join('');
            
            return `
                <div class="bot-grid" style="grid-template-columns: repeat(2, 1fr);">
                    ${modelCards}
                </div>
                
                <!-- Recent Activity Section -->
                <div style="margin-top: 16px;">
                    <div class="section-header" style="margin-bottom: 12px;">
                        <div>
                            <span class="section-title" style="margin: 0;">Recent Activity</span>
                        </div>
                        <button onclick="toggleActivityExpand()" id="activity-expand-btn" style="background: none; border: none; color: var(--blue); font-size: 13px; cursor: pointer;">Show More ‚Üí</button>
                    </div>
                    
                    <div class="activity-list" id="recent-activity-list" style="display: flex; flex-direction: column; gap: 10px;">
                        <div style="background: var(--bg-card); backdrop-filter: var(--glass-blur); border-radius: 16px; padding: 14px; border: 1px solid var(--glass-border); box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2), inset 0 1px 0 var(--glass-shine); display: flex; align-items: flex-start; gap: 12px;">
                            <div style="width: 36px; height: 36px; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 16px; flex-shrink: 0; background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.15);">üí¨</div>
                            <div style="flex: 1; min-width: 0;">
                                <div style="font-size: 14px; font-weight: 500; line-height: 1.5; margin-bottom: 6px;">Sent WhatsApp message</div>
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <span style="font-size: 11px; color: var(--text-tertiary); padding: 3px 8px; background: rgba(255, 255, 255, 0.06); border-radius: 6px;">01:44</span>
                                    <span class="activity-badge" style="background: rgba(162, 132, 94, 0.35); color: var(--brown);">System</span>
                                </div>
                            </div>
                        </div>
                        
                        <div style="background: var(--bg-card); backdrop-filter: var(--glass-blur); border-radius: 16px; padding: 14px; border: 1px solid var(--glass-border); box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2), inset 0 1px 0 var(--glass-shine); display: flex; align-items: flex-start; gap: 12px;">
                            <div style="width: 36px; height: 36px; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 16px; flex-shrink: 0; background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.15);">üìù</div>
                            <div style="flex: 1; min-width: 0;">
                                <div style="font-size: 14px; font-weight: 500; line-height: 1.5; margin-bottom: 6px;">Updated Mission Control HTML</div>
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <span style="font-size: 11px; color: var(--text-tertiary); padding: 3px 8px; background: rgba(255, 255, 255, 0.06); border-radius: 6px;">01:30</span>
                                    <span class="activity-badge" style="background: rgba(162, 132, 94, 0.35); color: var(--brown);">System</span>
                                </div>
                            </div>
                        </div>
                        
                        <div style="background: var(--bg-card); backdrop-filter: var(--glass-blur); border-radius: 16px; padding: 14px; border: 1px solid var(--glass-border); box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2), inset 0 1px 0 var(--glass-shine); display: flex; align-items: flex-start; gap: 12px;">
                            <div style="width: 36px; height: 36px; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 16px; flex-shrink: 0; background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.15);">üîç</div>
                            <div style="flex: 1; min-width: 0;">
                                <div style="font-size: 14px; font-weight: 500; line-height: 1.5; margin-bottom: 6px;">Web search: Mission Control best practices</div>
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <span style="font-size: 11px; color: var(--text-tertiary); padding: 3px 8px; background: rgba(255, 255, 255, 0.06); border-radius: 6px;">01:15</span>
                                    <span class="activity-badge" style="background: rgba(10, 132, 255, 0.35); color: var(--blue);">Kimi</span>
                                </div>
                            </div>
                        </div>
                        
                        <div style="background: var(--bg-card); backdrop-filter: var(--glass-blur); border-radius: 16px; padding: 14px; border: 1px solid var(--glass-border); box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2), inset 0 1px 0 var(--glass-shine); display: flex; align-items: flex-start; gap: 12px;">
                            <div style="width: 36px; height: 36px; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 16px; flex-shrink: 0; background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.15);">‚ö°</div>
                            <div style="flex: 1; min-width: 0;">
                                <div style="font-size: 14px; font-weight: 500; line-height: 1.5; margin-bottom: 6px;">Completed INDEX+MATCH training module</div>
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <span style="font-size: 11px; color: var(--text-tertiary); padding: 3px 8px; background: rgba(255, 255, 255, 0.06); border-radius: 6px;">00:50</span>
                                    <span class="activity-badge" style="background: rgba(48, 209, 88, 0.35); color: var(--green);">Qwen3</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Expanded Activity List (Hidden by default) -->
                    <div id="expanded-activity-list" style="display: none; flex-direction: column; gap: 10px; margin-top: 10px;">
                        <div style="background: var(--bg-card); backdrop-filter: var(--glass-blur); border-radius: 16px; padding: 14px; border: 1px solid var(--glass-border); box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2), inset 0 1px 0 var(--glass-shine); display: flex; align-items: flex-start; gap: 12px;">
                            <div style="width: 36px; height: 36px; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 16px; flex-shrink: 0; background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.15);">üìÑ</div>
                            <div style="flex: 1; min-width: 0;">
                                <div style="font-size: 14px; font-weight: 500; line-height: 1.5; margin-bottom: 6px;">Generated daily summary</div>
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <span style="font-size: 11px; color: var(--text-tertiary); padding: 3px 8px; background: rgba(255, 255, 255, 0.06); border-radius: 6px;">23:59</span>
                                    <span class="activity-badge" style="background: rgba(162, 132, 94, 0.35); color: var(--brown);">System</span>
                                </div>
                            </div>
                        </div>
                        
                        <div style="background: var(--bg-card); backdrop-filter: var(--glass-blur); border-radius: 16px; padding: 14px; border: 1px solid var(--glass-border); box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2), inset 0 1px 0 var(--glass-shine); display: flex; align-items: flex-start; gap: 12px;">
                            <div style="width: 36px; height: 36px; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 16px; flex-shrink: 0; background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.15);">üìù</div>
                            <div style="flex: 1; min-width: 0;">
                                <div style="font-size: 14px; font-weight: 500; line-height: 1.5; margin-bottom: 6px;">Archived memory files</div>
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <span style="font-size: 11px; color: var(--text-tertiary); padding: 3px 8px; background: rgba(255, 255, 255, 0.06); border-radius: 6px;">23:00</span>
                                    <span class="activity-badge" style="background: rgba(162, 132, 94, 0.35); color: var(--brown);">System</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Calendar Section (‰ªäÊó• + Êú™‰æÜ) -->
                <div style="margin-top: 16px;">
                    <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 12px;">
                        <span class="section-title" style="margin: 0;">Calendar</span>
                        <button onclick="switchTab('tasks', null)" style="background: none; border: none; color: var(--blue); font-size: 13px; cursor: pointer;">View Kanban ‚Üí</button>
                    </div>
                    
                    <div class="calendar-date">Today, Feb 10</div>
                    
                    <div class="calendar-events" style="margin-bottom: 16px;">
                        <div class="calendar-event-card inprogress">
                            <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                                <div>
                                    <div class="calendar-event-time">‚è± 03:00 AM</div>
                                    <div class="calendar-event-title">Qwen3 Excel Training</div>
                                    <div class="calendar-event-subtitle">Dynamic Arrays Ë®ìÁ∑¥</div>
                                </div>
                                <span class="calendar-event-bot qwen3">Qwen3</span>
                            </div>
                        </div>
                        
                        <div class="calendar-event-card review">
                            <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                                <div>
                                    <div class="calendar-event-time">‚è± 09:00 AM</div>
                                    <div class="calendar-event-title">Progress Report</div>
                                    <div class="calendar-event-subtitle">Qwen3 Â≠∏ÁøíÈÄ≤Â∫¶ÂåØÂ†±</div>
                                </div>
                                <span class="calendar-event-bot qwen3">Qwen3</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="calendar-date">Tomorrow, Feb 11</div>
                    
                    <div class="calendar-events">
                        <div class="calendar-event-card review">
                            <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                                <div>
                                    <div class="calendar-event-time">‚è± 10:00 AM</div>
                                    <div class="calendar-event-title">Review Tasks</div>
                                    <div class="calendar-event-subtitle">ÂØ©Èñ±ÂæÖËæ¶‰∫ãÈ†Ö</div>
                                </div>
                                <span class="calendar-event-bot kimi">Kimi</span>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }
        
        function renderTasks() {
            return `
                <!-- Kanban Section -->
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                    <span class="section-title">Kanban</span>
                </div>
                
                <div class="kanban-grid">
                    <!-- Row 1 -->
                    <div class="kanban-column kanban-todo" onclick="openKanbanColumnModal('todo')" style="cursor: pointer;">
                        <div class="kanban-column-header">
                            <span class="kanban-column-title">Todo</span>
                            <span class="kanban-column-count">2</span>
                        </div>
                        <div class="kanban-cards" id="kanban-todo-preview">
                            <div class="kanban-card" >
                                <div class="kanban-card-title">Apple Notes ÂÇô‰ªΩÈ©óË≠âÊ©üÂà∂</div>
                                <div class="kanban-card-desc">ÂâµÂª∫ËÖ≥Êú¨È©óË≠â Apple Notes ÂÇô‰ªΩÂÆåÊï¥ÊÄß</div>
                                <div class="kanban-card-footer">
                                    <span class="kanban-card-bot" style="background: rgba(162, 132, 94, 0.35); color: var(--brown);">System</span>
                                    <span class="kanban-card-time">È´òÂÑ™ÂÖàÁ¥ö</span>
                                </div>
                            </div>
                            <div class="kanban-card" >
                                <div class="kanban-card-title">Qwen3 Excel Dynamic Arrays Ë®ìÁ∑¥</div>
                                <div class="kanban-card-footer">
                                    <span class="kanban-card-bot qwen3">Qwen3</span>
                                    <span class="kanban-card-time">‰ªäÊôö 03:00</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="kanban-column kanban-progress" onclick="openKanbanColumnModal('progress')" style="cursor: pointer;">
                        <div class="kanban-column-header">
                            <span class="kanban-column-title">In Progress</span>
                            <span class="kanban-column-count">1</span>
                        </div>
                        <div class="kanban-cards" id="kanban-progress-preview">
                            <div class="kanban-card" >
                                <div class="kanban-card-title">MEMORY.md ÈóúÈçµË®òÊÜ∂Ê®ôË®ò</div>
                                <div class="kanban-card-desc">Âª∫Á´ãÊ©üÂà∂Èò≤Ê≠¢ÈáçË¶ÅË≥áË®äË¢´Ë™§Âà™</div>
                                <div class="kanban-card-footer">
                                    <span class="kanban-card-bot" style="background: rgba(162, 132, 94, 0.35); color: var(--brown);">System</span>
                                    <span class="kanban-card-time">ÈÄ≤Ë°å‰∏≠</span>
                                </div>
                            </div>
                            <div class="kanban-card" >
                                <div class="kanban-card-title">Dashboard UI ÂÑ™Âåñ</div>
                                <div class="kanban-card-desc">ÊîπÂñÑÁî®Êà∂È´îÈ©óÂêå‰∫§‰∫í</div>
                                <div class="kanban-card-footer">
                                    <span class="kanban-card-bot" style="background: rgba(162, 132, 94, 0.35); color: var(--brown);">System</span>
                                    <span class="kanban-card-time">ÈÄ≤Ë°å‰∏≠</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Row 2 -->
                    <div class="kanban-column kanban-review" onclick="openKanbanColumnModal('review')" style="cursor: pointer;">
                        <div class="kanban-column-header">
                            <span class="kanban-column-title">Review</span>
                            <span class="kanban-column-count">0</span>
                        </div>
                        <div class="kanban-cards" id="kanban-review-preview">
                            <div class="kanban-card" >
                                <div class="kanban-card-title">Stock List Êï¥ÂêàËÖ≥Êú¨</div>
                                <div class="kanban-card-desc">Ê∏¨Ë©¶ Excel Ëá™ÂãïÂêà‰ΩµÂäüËÉΩ</div>
                                <div class="kanban-card-footer">
                                    <span class="kanban-card-bot" style="background: rgba(162, 132, 94, 0.35); color: var(--brown);">System</span>
                                    <span class="kanban-card-time">ÂæÖÂØ©Ê†∏</span>
                                </div>
                            </div>
                            
                            <div class="kanban-card" >
                                <div class="kanban-card-title">Token Áõ£ÊéßË≠¶Â†±</div>
                                <div class="kanban-card-desc">ÂÑ™Âåñ‰∏âÂ±§Ë≠¶ÂëäÁ≥ªÁµ±</div>
                                <div class="kanban-card-footer">
                                    <span class="kanban-card-bot" style="background: rgba(162, 132, 94, 0.35); color: var(--brown);">System</span>
                                    <span class="kanban-card-time">ÂæÖÂØ©Ê†∏</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="kanban-column kanban-done" onclick="openKanbanColumnModal('done')" style="cursor: pointer;">
                        <div class="kanban-column-header">
                            <span class="kanban-column-title">Done</span>
                            <span class="kanban-column-count">2</span>
                        </div>
                        <div class="kanban-cards" id="kanban-done-preview">
                            <div class="kanban-card" >
                                <div class="kanban-card-title">Excel XLOOKUP Ë®ìÁ∑¥ÂÆåÊàê</div>
                                <div class="kanban-card-footer">
                                    <span class="kanban-card-bot qwen3">Qwen3</span>
                                    <span class="kanban-card-time">Feb 6</span>
                                </div>
                            </div>
                            <div class="kanban-card" >
                                <div class="kanban-card-title">Excel INDEX+MATCH Ë®ìÁ∑¥ÂÆåÊàê</div>
                                <div class="kanban-card-footer">
                                    <span class="kanban-card-bot qwen3">Qwen3</span>
                                    <span class="kanban-card-time">Feb 7</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }
        
        function renderSearch() {
            return `
                <div class="section-header">
                    <span class="section-title">Search</span>
                </div>
                
                <div style="background: var(--bg-card); backdrop-filter: var(--glass-blur); border-radius: 16px; padding: 12px 16px; margin-bottom: 20px; display: flex; align-items: center; gap: 10px; border: 1px solid var(--glass-border); box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2), inset 0 1px 0 var(--glass-shine);">
                    <span style="font-size: 18px; color: var(--text-tertiary);">üîç</span>
                    <input type="text" placeholder="Search activities, tasks, memory..." style="background: transparent; border: none; color: var(--text-primary); font-size: 16px; flex: 1; outline: none;" id="search-input" oninput="handleSearch(this.value)">
                </div>
                
                <div id="search-results" style="display: flex; flex-direction: column; gap: 10px;">
                    <div style="color: var(--text-tertiary); text-align: center; padding: 60px 20px;">
                        <div style="font-size: 48px; margin-bottom: 12px;">üîç</div>
                        <div style="font-size: 16px; margin-bottom: 4px;">Search across everything</div>
                        <div style="font-size: 13px;">Activities, tasks, memory files...</div>
                    </div>
                </div>
            `;
        }
        
        function handleSearch(query) {
            const resultsContainer = document.getElementById('search-results');
            if (!query.trim()) {
                resultsContainer.innerHTML = `
                    <div style="color: var(--text-tertiary); text-align: center; padding: 60px 20px;">
                        <div style="font-size: 48px; margin-bottom: 12px;">üîç</div>
                        <div style="font-size: 16px; margin-bottom: 4px;">Search across everything</div>
                        <div style="font-size: 13px;">Activities, tasks, memory files...</div>
                    </div>
                `;
                return;
            }
            
            const q = query.toLowerCase();
            let results = [];
            
            // Search model activities
            Object.entries(modelActivitiesData).forEach(([modelId, data]) => {
                const modelName = modelId === 'kimi' ? 'Kimi' : 'Qwen3';
                data.activities.forEach(item => {
                    if (item.text.toLowerCase().includes(q) || item.time.toLowerCase().includes(q)) {
                        results.push({
                            type: 'Activity',
                            source: modelName,
                            title: item.text,
                            time: item.time,
                            icon: item.icon,
                            color: 'var(--orange)'
                        });
                    }
                });
                data.scheduled.forEach(item => {
                    if (item.text.toLowerCase().includes(q) || item.time.toLowerCase().includes(q)) {
                        results.push({
                            type: 'Scheduled',
                            source: modelName,
                            title: item.text,
                            time: item.time,
                            icon: item.icon,
                            color: 'var(--blue)'
                        });
                    }
                });
                data.completed.forEach(item => {
                    if (item.text.toLowerCase().includes(q) || item.time.toLowerCase().includes(q)) {
                        results.push({
                            type: 'Completed',
                            source: modelName,
                            title: item.text,
                            time: item.time,
                            icon: item.icon,
                            color: 'var(--green)'
                        });
                    }
                });
            });
            
            // Search kanban tasks
            Object.entries(kanbanColumnData).forEach(([colId, col]) => {
                col.items.forEach(item => {
                    if (item.title.toLowerCase().includes(q) || 
                        (item.desc && item.desc.toLowerCase().includes(q)) ||
                        item.bot.toLowerCase().includes(q)) {
                        results.push({
                            type: col.title,
                            source: item.bot,
                            title: item.title,
                            desc: item.desc,
                            time: item.time,
                            icon: 'üìù',
                            color: col.color
                        });
                    }
                });
            });
            
            // Search health data
            Object.values(healthData).forEach(service => {
                if (service.name && service.name.toLowerCase().includes(q)) {
                    results.push({
                        type: 'Service',
                        source: 'System',
                        title: service.name + ' - ' + (service.status === 'up' ? 'Operational' : 'Issue'),
                        time: service.responseTime + 'ms',
                        icon: service.icon || '‚öôÔ∏è',
                        color: service.status === 'up' ? 'var(--green)' : 'var(--red)'
                    });
                }
            });
            
            if (results.length === 0) {
                resultsContainer.innerHTML = `
                    <div style="color: var(--text-tertiary); text-align: center; padding: 60px 20px;">
                        <div style="font-size: 32px; margin-bottom: 12px;">üòï</div>
                        <div style="font-size: 16px;">No results found</div>
                    </div>
                `;
            } else {
                resultsContainer.innerHTML = results.map((r, i) => `
                    <div class="activity-item" style="background: var(--bg-card); backdrop-filter: var(--glass-blur); border-radius: 16px; padding: 14px; border: 1px solid var(--glass-border); box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2), inset 0 1px 0 var(--glass-shine); animation: fadeIn 0.3s ease ${i * 0.05}s both;">
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <span style="font-size: 20px;">${r.icon}</span>
                            <div style="flex: 1; min-width: 0;">
                                <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 4px;">
                                    <span style="font-size: 10px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.3px; padding: 2px 8px; border-radius: 10px; background: ${r.color}; color: #000;">${r.type}</span>
                                    <span style="font-size: 11px; color: var(--text-tertiary);">${r.source}</span>
                                </div>
                                <div style="font-size: 14px; font-weight: 500; line-height: 1.4; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">${r.title}</div>
                                ${r.desc ? `<div style="font-size: 12px; color: var(--text-tertiary); margin-top: 2px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">${r.desc}</div>` : ''}
                            </div>
                            <span style="font-size: 11px; color: var(--text-tertiary); flex-shrink: 0;">${r.time}</span>
                        </div>
                    </div>
                `).join('');
            }
        }
        
        function toggleActivityExpand() {
            const expandedList = document.getElementById('expanded-activity-list');
            const btn = document.getElementById('activity-expand-btn');
            
            if (expandedList.style.display === 'none') {
                expandedList.style.display = 'flex';
                btn.textContent = '‚Üê Show Less';
            } else {
                expandedList.style.display = 'none';
                btn.textContent = 'Show More ‚Üí';
            }
        }
        
        function openModelActivitiesModal(modelId) {
            const modal = document.getElementById('model-activities-modal');
            const title = document.getElementById('model-activities-title');
            const list = document.getElementById('model-activities-list');
            
            const model = modelStats[modelId];
            title.textContent = model.name;
            
            const data = modelActivitiesData[modelId] || { activities: [], scheduled: [], completed: [] };
            
            // Build tabs and content
            list.innerHTML = `
                <div style="display: flex; gap: 12px; margin-bottom: 20px; border-bottom: 1px solid rgba(255, 255, 255, 0.1); padding-bottom: 16px;">
                    <button onclick="switchModelTab('${modelId}', 'activities')" id="tab-activities-${modelId}" class="model-tab active" style="flex: 1; background: rgba(255, 255, 255, 0.15); border: 1px solid rgba(255, 255, 255, 0.25); color: var(--text-primary); padding: 10px 12px; border-radius: 12px; font-size: 11px; font-weight: 600; cursor: pointer; text-transform: uppercase; letter-spacing: 0.3px;">
                        Activities (${data.activities.length})
                    </button>
                    <button onclick="switchModelTab('${modelId}', 'scheduled')" id="tab-scheduled-${modelId}" class="model-tab" style="flex: 1; background: rgba(255, 255, 255, 0.08); border: 1px solid rgba(255, 255, 255, 0.15); color: var(--text-secondary); padding: 10px 12px; border-radius: 12px; font-size: 11px; font-weight: 600; cursor: pointer; text-transform: uppercase; letter-spacing: 0.3px;">
                        Scheduled (${data.scheduled.length})
                    </button>
                    <button onclick="switchModelTab('${modelId}', 'completed')" id="tab-completed-${modelId}" class="model-tab" style="flex: 1; background: rgba(255, 255, 255, 0.08); border: 1px solid rgba(255, 255, 255, 0.15); color: var(--text-secondary); padding: 10px 12px; border-radius: 12px; font-size: 11px; font-weight: 600; cursor: pointer; text-transform: uppercase; letter-spacing: 0.3px;">
                        Completed (${data.completed.length})
                    </button>
                </div>
                
                <div id="content-activities-${modelId}" class="model-content" style="height: 360px; overflow-y: auto;">
                    ${renderActivityList(data.activities, 'activities')}
                </div>
                
                <div id="content-scheduled-${modelId}" class="model-content" style="display: none; height: 360px; overflow-y: auto;">
                    ${renderActivityList(data.scheduled, 'scheduled')}
                </div>
                
                <div id="content-completed-${modelId}" class="model-content" style="display: none; height: 360px; overflow-y: auto;">
                    ${renderActivityList(data.completed, 'completed')}
                </div>
            `;
            
            modal.style.display = 'block';
        }
        
        function renderActivityList(activities, type) {
            if (activities.length === 0) {
                return '<div style="text-align: center; padding: 60px 20px; color: var(--text-tertiary);"><div style="font-size: 32px; margin-bottom: 12px;">üì≠</div><div>No items</div></div>';
            }
            return activities.map((activity, i) => `
                <div style="background: rgba(255, 255, 255, 0.04); backdrop-filter: blur(10px); border-radius: 14px; padding: 14px; margin-bottom: 10px; border: 1px solid rgba(255, 255, 255, 0.1); display: flex; align-items: flex-start; gap: 12px; animation: fadeIn 0.3s ease ${i * 0.05}s both;">
                    <div style="width: 36px; height: 36px; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 16px; flex-shrink: 0; background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.15);">
                        ${activity.icon}
                    </div>
                    <div style="flex: 1; min-width: 0;">
                        <div style="font-size: 14px; font-weight: 500; line-height: 1.5; margin-bottom: 6px;">${activity.text}</div>
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <span style="font-size: 11px; color: var(--text-tertiary); padding: 3px 8px; background: rgba(255, 255, 255, 0.06); border-radius: 6px;">${activity.time}</span>
                            ${type === 'completed' ? '<span style="font-size: 11px; color: var(--text-secondary);">‚úì Done</span>' : type === 'scheduled' ? '<span style="font-size: 11px; color: var(--text-secondary);">‚è± Scheduled</span>' : '<span style="font-size: 11px; color: var(--text-secondary);">Active</span>'}
                        </div>
                    </div>
                </div>
            `).join('');
        }
        
        function switchModelTab(modelId, tab) {
            const activeStyle = { bg: 'rgba(255, 255, 255, 0.15)', border: 'rgba(255, 255, 255, 0.25)', color: 'var(--text-primary)' };
            const inactiveStyle = { bg: 'rgba(255, 255, 255, 0.08)', border: 'rgba(255, 255, 255, 0.15)', color: 'var(--text-secondary)' };
            
            ['activities', 'scheduled', 'completed'].forEach(t => {
                const btn = document.getElementById(`tab-${t}-${modelId}`);
                const content = document.getElementById(`content-${t}-${modelId}`);
                if (t === tab) {
                    btn.style.background = activeStyle.bg;
                    btn.style.borderColor = activeStyle.border;
                    btn.style.color = activeStyle.color;
                    btn.style.border = `1px solid ${activeStyle.border}`;
                    content.style.display = 'block';
                    content.style.height = '360px';
                    content.style.overflowY = 'auto';
                } else {
                    btn.style.background = inactiveStyle.bg;
                    btn.style.borderColor = inactiveStyle.border;
                    btn.style.color = inactiveStyle.color;
                    btn.style.border = `1px solid ${inactiveStyle.border}`;
                    content.style.display = 'none';
                }
            });
        }
        
        function closeModelActivitiesModal() {
            document.getElementById('model-activities-modal').style.display = 'none';
        }
        
        // Close modal when clicking outside
        document.getElementById('model-activities-modal').addEventListener('click', function(e) {
            if (e.target === this) closeModelActivitiesModal();
        });
        
        // Health data
        let healthData = {
            openclaw: { status: 'up', responseTime: 120, icon: 'ü§ñ', name: 'OpenClaw', color: 'rgba(0, 122, 255, 0.35)' },
            whatsapp: { status: 'up', responseTime: 45, icon: 'üí¨', name: 'WhatsApp', color: 'rgba(52, 199, 89, 0.35)' },
            kimi: { status: 'up', responseTime: 2500, icon: '‚òÅÔ∏è', name: 'Kimi', color: 'rgba(175, 82, 222, 0.35)' },
            qwen3: { status: 'up', responseTime: 1800, icon: 'ü¶æ', name: 'Qwen3', color: 'rgba(255, 149, 0, 0.35)' },
            lastCheck: new Date().toLocaleTimeString('zh-HK')
        };

        function getStatusIcon(status) {
            return status === 'up' ? 'üü¢' : status === 'degraded' ? 'üü°' : 'üî¥';
        }
        
        function getOverallStatus() {
            const statuses = Object.values(healthData).filter(v => v.status).map(v => v.status);
            if (statuses.every(s => s === 'up')) return { text: 'Online', color: 'var(--green)' };
            if (statuses.some(s => s === 'down')) return { text: 'Down', color: 'var(--red)' };
            return { text: 'Degraded', color: 'var(--yellow)' };
        }
        
        function openHealthModal() {
            const modal = document.getElementById('health-modal');
            const servicesContainer = document.getElementById('health-services');
            const lastCheckEl = document.getElementById('modal-last-check');
            const overallStatusEl = document.getElementById('modal-overall-status');
            
            // Update last check time
            healthData.lastCheck = new Date().toLocaleTimeString('zh-HK');
            lastCheckEl.textContent = healthData.lastCheck;
            
            // Update overall status
            const overall = getOverallStatus();
            overallStatusEl.textContent = overall.text;
            overallStatusEl.style.color = overall.color;
            
            // Generate services HTML
            const services = ['openclaw', 'whatsapp', 'kimi', 'qwen3'];
            servicesContainer.innerHTML = services.map(key => {
                const service = healthData[key];
                return `
                    <div style="background: rgba(255, 255, 255, 0.06); backdrop-filter: blur(20px); border-radius: 16px; padding: 14px; display: flex; align-items: center; gap: 12px; border: 1px solid rgba(255, 255, 255, 0.15); box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2), inset 0 1px 0 rgba(255, 255, 255, 0.1);">
                        <div style="width: 44px; height: 44px; background: ${service.color}; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 20px; backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.2);">
                            ${service.icon}
                        </div>
                        <div style="flex: 1;">
                            <div style="font-size: 15px; font-weight: 600; margin-bottom: 2px;">${service.name}</div>
                            <div style="font-size: 12px; color: var(--text-secondary);">
                                ${service.status === 'up' ? 'Operational' : service.status === 'degraded' ? 'Degraded' : 'Down'}
                            </div>
                        </div>
                        <div style="text-align: right;">
                            <div style="font-size: 16px;">${getStatusIcon(service.status)}</div>
                            <div style="font-size: 11px; color: var(--text-secondary); margin-top: 2px;">${service.responseTime}ms</div>
                        </div>
                    </div>
                `;
            }).join('');
            
            modal.style.display = 'block';
        }
        
        function closeHealthModal() {
            document.getElementById('health-modal').style.display = 'none';
        }
        
        // Close modal when clicking outside
        document.getElementById('health-modal').addEventListener('click', function(e) {
            if (e.target === this) closeHealthModal();
        });
        
        function updateHeaderStatus() {
            const overall = getOverallStatus();
            const badge = document.getElementById('system-status-badge');
            const text = document.getElementById('system-status-text');
            const dot = badge.querySelector('.status-dot');
            
            if (overall.text === 'Online') {
                badge.style.background = 'rgba(52, 199, 89, 0.15)';
                badge.style.color = 'var(--green)';
                dot.style.background = 'var(--green)';
                text.textContent = 'System Online';
            } else if (overall.text === 'Degraded') {
                badge.style.background = 'rgba(255, 149, 0, 0.15)';
                badge.style.color = 'var(--orange)';
                dot.style.background = 'var(--orange)';
                text.textContent = 'System Degraded';
            } else {
                badge.style.background = 'rgba(255, 59, 48, 0.15)';
                badge.style.color = 'var(--red)';
                dot.style.background = 'var(--red)';
                text.textContent = 'System Down';
            }
        }
        
        // Initial render
        render();
        updateHeaderStatus();
        
        // ÊØè 5 ÂàÜÈêòÊõ¥Êñ∞‰∏ÄÊ¨°ÁãÄÊÖã
        setInterval(updateHeaderStatus, 5 * 60 * 1000);
        
        // ===== Phase 1: LocalStorage & Data Management =====
        
        // ÂÑ≤Â≠òÁî®Êà∂ÂÅèÂ•Ω
        function savePreferences() {
            const prefs = {
                activeTab: currentTab,
                activityExpanded: document.getElementById('expanded-activity-list')?.style.display === 'flex',
                lastVisit: new Date().toISOString()
            };
            localStorage.setItem('missionControlPrefs', JSON.stringify(prefs));
        }
        
        // ËÆÄÂèñÁî®Êà∂ÂÅèÂ•Ω
        function loadPreferences() {
            try {
                const prefs = JSON.parse(localStorage.getItem('missionControlPrefs'));
                if (prefs) {
                    // ÈÇÑÂéü tab
                    if (prefs.activeTab && ['dashboard', 'tasks', 'activity', 'calendar', 'search'].includes(prefs.activeTab)) {
                        currentTab = prefs.activeTab;
                    }
                    // ÈÇÑÂéüÂ±ïÈñãÁãÄÊÖã
                    if (prefs.activityExpanded) {
                        const expandedList = document.getElementById('expanded-activity-list');
                        const btn = document.getElementById('activity-expand-btn');
                        if (expandedList && btn) {
                            expandedList.style.display = 'flex';
                            btn.textContent = '‚Üê Show Less';
                        }
                    }
                }
            } catch (e) {
                console.log('No preferences found');
            }
        }
        
        // Refresh Êï∏ÊìöÂäüËÉΩ
        function refreshData() {
            const btn = document.querySelector('[onclick="refreshData()"]') || document.getElementById('refresh-btn');
            if (btn) {
                btn.style.opacity = '0.5';
                btn.textContent = 'üîÑ Êõ¥Êñ∞‰∏≠...';
            }
            
            // Ê®°Êì¨Êõ¥Êñ∞ÔºàÂØ¶ÈöõÊáâÁî®‰∏≠Âë¢Â∫¶ÊúÉ call APIÔºâ
            setTimeout(() => {
                updateHeaderStatus();
                render();
                savePreferences();
                
                if (btn) {
                    btn.style.opacity = '1';
                    btn.textContent = 'üîÑ Refresh';
                }
                
                // È°ØÁ§∫Êõ¥Êñ∞ÊàêÂäüÊèêÁ§∫
                showToast('‚úì Êï∏ÊìöÂ∑≤Êõ¥Êñ∞');
            }, 800);
        }
        
        // Toast ÊèêÁ§∫Ôºà‰∏≠ÊÄßÁÅ∞ÁôΩ Liquid GlassÔºâ
        function showToast(message) {
            const toast = document.createElement('div');
            toast.style.cssText = `
                position: fixed;
                top: 60px;
                left: 50%;
                transform: translateX(-50%);
                background: rgba(255, 255, 255, 0.9);
                backdrop-filter: blur(20px) saturate(180%);
                -webkit-backdrop-filter: blur(20px) saturate(180%);
                color: #1F2937;
                padding: 14px 28px;
                border-radius: 16px;
                font-size: 15px;
                font-weight: 600;
                z-index: 9999;
                animation: fadeIn 0.35s cubic-bezier(0.16, 1, 0.3, 1);
                box-shadow: 0 8px 32px rgba(0, 0, 0, 0.12), 0 2px 8px rgba(0, 0, 0, 0.06);
                border: 1px solid rgba(255, 255, 255, 0.6);
                max-width: 90%;
                text-align: center;
            `;
            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.style.opacity = '0';
                toast.style.transform = 'translateX(-50%) translateY(-10px)';
                toast.style.transition = 'all 0.3s ease';
                setTimeout(() => toast.remove(), 300);
            }, 2500);
        }
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.style.opacity = '0';
                toast.style.transition = 'opacity 0.3s';
                setTimeout(() => toast.remove(), 300);
            }, 2000);
        }
        
        // È†ÅÈù¢ÈóúÈñâÂâçÂÑ≤Â≠òÂÅèÂ•Ω
        window.addEventListener('beforeunload', savePreferences);
        
        // ËºâÂÖ•ÊôÇÈÇÑÂéüÂÅèÂ•Ω
        localStorage.removeItem("missionControlPrefs"); loadPreferences();
        
        // ÂÆöÊúüËá™ÂãïÂÑ≤Â≠òÔºàÊØè 30 ÁßíÔºâ
        setInterval(savePreferences, 30000);
        
        // ===== ÂØ¶ÊôÇÁ≥ªÁµ±ÁãÄÊÖãÁõ£Êéß =====
        const STATUS_API_URL = 'http://localhost:3456/api/status';
        const STATUS_REFRESH_INTERVAL = 30000; // 30Áßí
        
        // Áç≤ÂèñÁúüÂØ¶Á≥ªÁµ±ÁãÄÊÖã
        async function fetchRealSystemStatus() {
            try {
                const response = await fetch(STATUS_API_URL, {
                    method: 'GET',
                    headers: { 'Accept': 'application/json' },
                    signal: AbortSignal.timeout ? AbortSignal.timeout(5000) : undefined
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                
                const data = await response.json();
                lastRealStatus = data.services;
                usingRealData = true;
                
                // Êõ¥Êñ∞ healthData
                updateHealthDataFromReal(data.services);
                updateHeaderStatus();
                
                // Â¶ÇÊûú Modal ÊâìÈñãÔºåÊõ¥Êñ∞ Modal
                const modal = document.getElementById('health-modal');
                if (modal && modal.style.display === 'block') {
                    openHealthModal();
                }
                
                return data;
            } catch (error) {
                console.log('Status API unavailable, using mock data:', error.message);
                usingRealData = false;
                return null;
            }
        }
        
        // Â∞á API Êï∏ÊìöËΩâÊèõÁÇ∫ healthData Ê†ºÂºè
        function updateHealthDataFromReal(services) {
            const statusMap = {
                'online': 'up',
                'degraded': 'degraded',
                'offline': 'down'
            };
            
            Object.entries(services).forEach(([key, data]) => {
                if (healthData[key]) {
                    healthData[key].status = statusMap[data.status] || 'down';
                    healthData[key].responseTime = data.latency || 0;
                }
            });
            
            healthData.lastCheck = new Date().toLocaleTimeString('zh-HK');
        }
        
        // ÂïüÂãïÂØ¶ÊôÇÁãÄÊÖãÁõ£Êéß
        function startRealTimeStatus() {
            // Á´ãÂç≥Áç≤Âèñ‰∏ÄÊ¨°
            fetchRealSystemStatus();
            
            // ÂÆöÊúüÂà∑Êñ∞
            setInterval(fetchRealSystemStatus, STATUS_REFRESH_INTERVAL);
        }
        
        // ‰øÆÊîπ refreshData ‰ª•ÂåÖÂê´ÁúüÂØ¶ÁãÄÊÖãÊõ¥Êñ∞
        const originalRefreshData = refreshData;
        refreshData = function() {
            const btn = document.querySelector('[onclick="refreshData()"]') || document.getElementById('refresh-btn');
            if (btn) {
                btn.style.opacity = '0.5';
                btn.textContent = 'üîÑ Êõ¥Êñ∞‰∏≠...';
            }
            
            // Áç≤ÂèñÁúüÂØ¶ÁãÄÊÖã
            fetchRealSystemStatus().then(() => {
                render();
                savePreferences();
                
                if (btn) {
                    btn.style.opacity = '1';
                    btn.textContent = 'üîÑ Refresh';
                }
                
                const statusText = usingRealData ? '‚úì Â∑≤ÈÄ£Êé•ÁúüÂØ¶Á≥ªÁµ±' : '‚úì Êï∏ÊìöÂ∑≤Êõ¥Êñ∞ (Demo Mode)';
                showToast(statusText);
            });
        };
        
        // È†ÅÈù¢ÂèØË¶ãÊÄßËÆäÂåñÊôÇÂà∑Êñ∞
        document.addEventListener('visibilitychange', () => {
            if (!document.hidden) {
                fetchRealSystemStatus();
            }
        });
        
        // ÂïüÂãïÂØ¶ÊôÇÁõ£Êéß
        startRealTimeStatus();
        
        // Èñã App Ëá™ÂãïÂà∑Êñ∞ÔºàÈ°ØÁ§∫‰∏≠ÊÄßÁÅ∞ÁôΩ ToastÔºâ
        document.addEventListener('DOMContentLoaded', () => {
            // ÂÖàÊ∏≤Êüì‰∏ÄÊ¨°Á¢∫‰øùÊúâÂÖßÂÆπÈ°ØÁ§∫
            render();
            
            // È°ØÁ§∫Âà∑Êñ∞ÊåáÁ§∫Âô®
            const indicator = document.createElement('div');
            indicator.id = 'refresh-indicator';
            indicator.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: rgba(255, 255, 255, 0.85);
                backdrop-filter: blur(20px) saturate(180%);
                -webkit-backdrop-filter: blur(20px) saturate(180%);
                color: #1F2937;
                padding: 20px 32px;
                border-radius: 16px;
                font-size: 15px;
                font-weight: 500;
                z-index: 9999;
                display: flex;
                align-items: center;
                gap: 12px;
                box-shadow: 0 8px 32px rgba(0, 0, 0, 0.12);
                border: 1px solid rgba(255, 255, 255, 0.6);
            `;
            indicator.innerHTML = `
                <div style="width: 20px; height: 20px; border: 3px solid #E5E7EB; border-top-color: #1F2937; border-radius: 50%; animation: spin 0.8s linear infinite;"></div>
                <span>Ê≠£Âú®ÂêåÊ≠•Êï∏Êìö...</span>
            `;
            document.body.appendChild(indicator);
            
            // Âü∑Ë°åÂà∑Êñ∞
            setTimeout(() => {
                fetchRealSystemStatus().then(() => {
                    render();
                    document.getElementById('refresh-indicator')?.remove();
                    showToast(usingRealData ? '‚úÖ Â∑≤ÈÄ£Êé•ÁúüÂØ¶Á≥ªÁµ±' : '‚úÖ Êï∏ÊìöÂ∑≤Êõ¥Êñ∞ (Demo Mode)');
                }).catch(() => {
                    render();
                    document.getElementById('refresh-indicator')?.remove();
                    showToast('‚ö†Ô∏è ‰ΩøÁî®Èõ¢Á∑öÊ®°Âºè');
                });
            }, 500);
        });
    </script>
</body>
</html>
